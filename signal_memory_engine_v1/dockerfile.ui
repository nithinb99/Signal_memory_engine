# syntax=docker/dockerfile:1.6
FROM python:3.11-slim

ENV PIP_DEFAULT_TIMEOUT=120 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    curl git ca-certificates && \
    rm -rf /var/lib/apt/lists/*

# Upgrade tools first
RUN --mount=type=cache,target=/root/.cache/pip \
    python -m pip install --upgrade pip setuptools wheel

# If your UI uses pandas/numpy/pyarrow, preinstall the heavy ones first
RUN --mount=type=cache,target=/root/.cache/pip \
    pip install --prefer-binary numpy==2.2.3 pandas==2.3.2 pyarrow==21.0.0

COPY requirements.txt .
RUN --mount=type=cache,target=/root/.cache/pip \
    pip install --prefer-binary --no-cache-dir -r requirements.txt

# If your UI imports project modules, copy the repo; else just the streamlit files
COPY . .

EXPOSE 8501
CMD ["streamlit", "run", "streamlit_app.py", "--server.address=0.0.0.0", "--server.port=8501"]
